var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};var myChart=null,loadMapDone=$.Deferred(),map=null;mapboxglToken="pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4M29iazA2Z2gycXA4N2pmbDZmangifQ.-g_vE53SD2WrJ6tFX7QHmA";mapboxgl.accessToken=mapboxglToken;var ENCODE_SCALE=1E6,opacityZoom=14;function loadMapBox(a){console.log(a);map=new mapboxgl.Map({container:a.container,center:a.center||[118.78307001849998,32.04314031903807],zoom:a.zoom||14,pitch:a.pitch||0,bearing:a.bearing||0,maxZoom:a.maxZoom||20,minZoom:a.minZoom||0,altitudeScale:2,style:a.style||"mapbox://styles/mapbox/dark-v9"});a.fullscreenControl&&map.addControl(new mapboxgl.FullscreenControl,a.fullscreenControl);a.navigationControl&&map.addControl(new mapboxgl.NavigationControl({showZoom:!1}),a.navigationControl);map.on("click",function(a){console.log(a.lngLat.lng+","+a.lngLat.lat)});map.on("load",function(){loadMapDone.resolve()})}var tt,lastClickI="";function loadBuildings(a,b,c){var d=opacityZoom;map.addLayer({id:c,type:"fill-extrusion",minzoom:d,source:{type:"geojson",data:a},paint:{"fill-extrusion-color":b||["get","color"],"fill-extrusion-height":["get","height"],"fill-extrusion-base":["get","base_height"],"fill-extrusion-opacity":["interpolate",["linear"],["zoom"],d,0,d+2,1]}});map.on("click",c,function(a){var b=a.features[0].properties.i;if(-1==(","+allowClickBuliding+",").indexOf(","+a.features[0].properties.name+","))return!1;console.log(a.features[0].properties);var d="",e=a.features[0].properties.data;if(e){console.log(e);for(var e=e.split(";"),d=d+"\x3cdiv style\x3d'text-align: center;'\x3e",h=0;h<e.length;h++)d=h==e.length-1?d+("\x3cspan class\x3d'company'\x3e"+e[h].split(",")[1]+"\x3c/span\x3e"):d+("\x3cspan class\x3d'company'\x3e"+e[h].split(",")[1]+"\x3c/span\x3e\x3cbr\x3e")}building.features[b].properties.color="#FFD723";try{parent.window.postMessage({type:"building",buildingName:a.features[0].properties.name},"*")}catch(l){}""!==lastClickI&&(building.features[lastClickI].properties.color="#69c8ec");map.getSource(c).setData(building);drawingI[b]||draw(building.features[b].properties.height,b,c,!0);lastClickI===b&&(b="");lastClickI=b})}var drawingI={};function draw(a,b,c,d){drawingI[b]=1;d?(building.features[b].properties.base_height++,building.features[b].properties.height++):(building.features[b].properties.base_height--,building.features[b].properties.height--);map.getSource(c).setData(building);building.features[b].properties.height>=2*a&&(d=!1);building.features[b].properties.height<=a?drawingI[b]=null:requestAnimationFrame(function(){draw(a,b,c,d)})}function loadCanvas(a,b,c){map.addSource(b,{type:"canvas",canvas:a,animate:!0,coordinates:c})}function addFront(a,b,c){map.addSource("image"+c,{type:"image",url:a,coordinates:b});map.addLayer({id:"raster"+c,source:"image"+c,type:"raster",paint:{"raster-opacity":["interpolate",["linear"],["zoom"],opacityZoom+2,0,opacityZoom+2+2,1]}})}function addFrontLabel(a,b,c){var d=opacityZoom;a={id:b,type:"symbol",minzoom:d,source:{type:"geojson",data:a},layout:{"symbol-placement":c,"text-field":["get","text"],"text-pitch-alignment":"viewport","text-size":["get","size"],"text-letter-spacing":["get","spacing"],"text-allow-overlap":!0},paint:{"text-color":"white","text-opacity":["interpolate",["linear"],["zoom"],d,0,d+2,1]}};console.log(a);map.addLayer(a)}function loadIcons(a,b,c,d,e){var f=opacityZoom;map.addLayer({id:d,type:"symbol",source:{type:"geojson",data:a},layout:{"icon-image":c,"icon-size":b,"icon-allow-overlap":!0,"icon-anchor":e||"bottom"},paint:{"icon-opacity":["interpolate",["linear"],["zoom"],f-.5,1,f,0]}})}function loadIconsShow(a,b,c,d,e){b=opacityZoom;map.addLayer({id:d,type:"symbol",minzoom:b,source:{type:"geojson",data:a},layout:{"icon-image":c||["get","image"],"icon-size":["get","size"],"icon-allow-overlap":!0,"icon-anchor":e||"bottom"},paint:{"icon-opacity":["interpolate",["linear"],["zoom"],b,0,b+2,1]}});map.on("click",d,function(a){for(var b={},c=0;c<a.features.length;c++)b[a.features[c].properties.key]?b[a.features[c].properties.key].push({id:a.features[c].properties.id}):b[a.features[c].properties.key]=[{id:a.features[c].properties.id}];b.type="icon";console.log(b);try{parent.window.postMessage(b,"*")}catch(h){}})}function loadImage(a,b,c,d,e){a={type:"FeatureCollection",features:a};map.addLayer({id:d,type:"symbol",source:{type:"geojson",data:a},layout:{"icon-image":c,"icon-size":b,"icon-allow-overlap":!0}});return a}function loadIconsTest(a,b,c,d,e){map.addLayer({id:d,type:"symbol",source:{type:"geojson",data:{type:"FeatureCollection",features:a}},layout:{"symbol-placement":"line","symbol-spacing":1,"symbol-avoid-edges":!0,"icon-allow-overlap":!0,"icon-rotation-alignment":"map","icon-image":c,"icon-size":b}})}function loadLines(a,b,c,d,e,f){a={id:""+d,type:"line",source:{type:"geojson",data:a},paint:{"line-width":b,"line-color":c||["get","linecolor"]}};e&&(a.paint["line-opacity"]=["interpolate",["linear"],["zoom"],e,0,e+2,1]);f&&(a.maxzoom=f,a.paint["line-opacity"]=["interpolate",["linear"],["zoom"],f-2,1,f,0]);map.addLayer(a)}function loadPolygon(a,b,c,d,e,f,g){a={id:d,type:"fill",minzoom:e||0,source:{type:"geojson",data:a},layout:{},paint:{"fill-color":b||["get","color"],"fill-opacity":c},background:{"background-color":"red"}};e&&(b=["interpolate",["linear"],["zoom"],e,0,e+2,c||1],a.paint["fill-opacity"]=b);g&&(a.maxzoom=g,b=["interpolate",["linear"],["zoom"],g-2,c||1,g,0],a.paint["fill-opacity"]=b);g&&e&&(a.maxzoom=g,b=["interpolate",["linear"],["zoom"],e,0,e+2,c||1,g,0],a.paint["fill-opacity"]=b);f&&(a.paint["fill-outline-color"]=f);map.addLayer(a)}function loadChartAndMap(a){myChart=echarts.init(document.getElementById(a.container));Promise.all([$.getJSON("data/data-1498751206824-HkkgZsfEW.json"),readShp]).then(function(b){b=$jscomp.makeIterator(b);b.next();b.next();echarts.registerMap("buildings",geoJSON);myChart.setOption({mapbox3D:{center:a.center||[118.78307001849998,32.04314031903807],zoom:a.zoom||14,pitch:a.pitch||50,bearing:a.bearing||-10,altitudeScale:2,style:"mapbox://styles/mapbox/dark-v9",postEffect:{enable:!0,screenSpaceAmbientOcclusion:{enable:!0,intensity:1.2,radius:6,quality:"high"}},light:{main:{intensity:.1,shadow:!1,shadowQuality:"low",color:"#355a81"},ambient:{intensity:0},ambientCubemap:{texture:"img/222.png",exposure:1,diffuseIntensity:.5,specularIntensity:2}}},series:[]});myChart._model.eachComponent("mapbox3D",function(a){null==map&&(map=a._mapbox)});map.on("click",function(a){console.log(a.lngLat.lng+","+a.lngLat.lat)});map.setMaxZoom(a.maxZoom||18);map.setMinZoom(a.minZoom||10);loadRegionsDone.done(function(){map.on("load",function(){map.loadImage("img/ttl_24.png",function(a,b){if(a)throw a;map.addImage("camera1",b)});map.loadImage("img/wrj_03.png",function(a,b){if(a)throw a;map.addImage("camera2",b)});map.loadImage("img/ttl_24.png",function(a,b){if(a)throw a;map.addImage("shexiangtou",b)});map.loadImage("img/ttl_46.png",function(a,b){if(a)throw a;map.addImage("wifi",b)});map.loadImage("img/ttl_28.png",function(a,b){if(a)throw a;map.addImage("jingyuan",b)});map.loadImage("img/ttl_31.png",function(a,b){if(a)throw a;map.addImage("jingche",b)});map.loadImage("img/2_03.png",function(a,b){if(a)throw a;map.addImage("point",b)});loadMapDone.resolve()})})});window.addEventListener("keydown",function(){myChart.dispatchAction({type:"lines3DToggleEffect",seriesIndex:0})})}function drawlines3D(a,b,c){c=c||10;b=$.extend({height:5,width:.5,color:"rgb(200, 40, 0)",opacity:0},b);for(var d=[],e=0;e<a.length;e++){for(var f=a[e].split(";"),g=0;g<f.length;g++){var k=f[g].split(",");k.push(b.height);f[g]=k}for(g=0;g<c;g++)d.push({coords:f})}a=myChart.getOption().series;a.push({type:"lines3D",coordinateSystem:"mapbox",effect:{show:!0,constantSpeed:5,trailWidth:2,trailLength:.8,trailOpacity:1,spotIntensity:10},blendMode:"lighter",polyline:!0,lineStyle:{width:b.width,color:b.color,opacity:b.opacity},data:{count:function(){return d.length},getItem:function(a){return d[a]}}});myChart.setOption({series:a})}function decodeLine(a){for(var b=[],c=a[0],d=a[1],e=0;e<a[2].length;e+=2){var f=a[2].charCodeAt(e)-64,g=a[2].charCodeAt(e+1)-64,f=f>>1^-(f&1),g=g>>1^-(g&1),f=f+c,g=g+d,c=f,d=g;b.push([f/ENCODE_SCALE,g/ENCODE_SCALE,10])}return b}function getLineFeature(a,b){return{type:"Feature",properties:{color:a},geometry:{type:"LineString",coordinates:b}}}function getLineFeatureArr(a){if(0!=arguments.length){for(var b=[],c=1;c<arguments.length;c++)b.push(getLineFeature(a,arguments[c]));return b}};